# Kong AWS Masking - API μΌκ΄€μ„± λ¶„μ„ λ° μ•„ν‚¤ν…μ² κ²€μ¦

**λ¶„μ„μΌμ‹**: 2025λ…„ 7μ›” 23μΌ  
**λ¶„μ„μ**: Claude Code Assistant  
**λ©μ **: μ‚¬μ©μ ν”Όλ“λ°± κΈ°λ° API ν¬λ§· μΌκ΄€μ„± κ²€μ¦

---

## π¨ μ‚¬μ©μ ν•µμ‹¬ ν”Όλ“λ°±

> **μ‚¬μ©μ μ§€μ μ‚¬ν•­**: "μ‚¬μ©μ μ…λ ¥ κ°’μ΄λ―€λ΅ {"text": "Check i-1234567890abcdef0 status"} μ΄κ² λ§μ§€ μ•λ‚μ”? claude apiλ¥Ό νΈμ¶ν•λ” ν¬λ©§κ³Ό λ™μΌν•κ² ν•΄μ•Ό ν•©λ‹λ‹¤. μ΄κ²ƒμ€ μ½”λ“ ν’μ§μ„ λ§¤μ° λ‚μκ² ν• μ μκ³  μ μ§€λ³΄μμ„±μ„ λ–¨μ–΄λ¨λ ¤μ”."

**ν•µμ‹¬ μ°λ ¤μ‚¬ν•­**:
1. ν΄λΌμ΄μ–ΈνΈ μ…λ ¥ ν¬λ§·κ³Ό Claude API ν¬λ§· λ¶μΌμΉ
2. μ½”λ“ ν’μ§ μ €ν• κ°€λ¥μ„±
3. μ μ§€λ³΄μμ„± λ¬Έμ 

---

## π” μ‹¤μ  μ½”λ“ λ λ²¨ λ¶„μ„

### 1. ν„μ¬ λ°μ΄ν„° ν”λ΅μ° κ²€μ¦

#### 1.1 ν΄λΌμ΄μ–ΈνΈ β†’ Backend API
```bash
# ν΄λΌμ΄μ–ΈνΈ μ”μ²­
POST localhost:3000/analyze
Content-Type: application/json

{
  "resources": ["ec2"],
  "options": {
    "analysisType": "security_only"
  }
}
```

#### 1.2 Backend λ‚΄λ¶€ μ²λ¦¬ (analyze.js:119-134)
```javascript
// Step 1: AWS λ¦¬μ†μ¤ μμ§‘
awsResources = await awsService.collectResources({
  resources,         // ["ec2"]
  region: options.region,
  skipCache: options.skipCache,
  timeout: timeout
});

// Step 2: Claude API λ¶„μ„ μ”μ²­
analysis = await claudeService.analyzeAwsData(awsResources, {
  analysisType: options.analysisType,  // "security_only"
  maxTokens: 2048,
  systemPrompt: options.systemPrompt
});
```

#### 1.3 AWS λ°μ΄ν„° λ³€ν™ (claudeService.js:163-183)
```javascript
buildAnalysisPrompt(awsData, options) {
  const analysisType = options.analysisType || 'security_and_optimization';
  
  let prompt = `Please analyze the following AWS infrastructure data for ${analysisType}:\n\n`;
  
  // AWS λ°μ΄ν„°λ¥Ό ν…μ¤νΈλ΅ λ³€ν™
  for (const [resourceType, resources] of Object.entries(awsData)) {
    const resourceArray = Array.isArray(resources) ? resources : resources.data || [];
    prompt += `${resourceType.toUpperCase()} Resources (${resourceArray.length} items):\n`;
    prompt += JSON.stringify(resourceArray, null, 2) + '\n\n';  // μ‹¤μ  AWS ν¨ν„΄ ν¬ν•¨
  }
  
  prompt += this.getAnalysisInstructions(analysisType);
  return prompt;
}
```

#### 1.4 Claude API ν¬λ§· μƒμ„± (claudeService.js:114-122)
```javascript
const claudeRequest = {
  model: this.model,                    // "claude-3-5-sonnet-20241022"
  max_tokens: options.maxTokens || 2048,
  system: options.systemPrompt || 'You are a helpful AWS infrastructure analysis assistant.',
  messages: [{
    role: 'user',
    content: prompt                     // μ‹¤μ  AWS ν¨ν„΄μ΄ ν¬ν•¨λ ν…μ¤νΈ
  }]
};
```

#### 1.5 Kongμ„ ν†µν• Claude API νΈμ¶ (claudeService.js:265-276)
```javascript
const response = await axios.post(
  `${this.kongUrl}/analyze-claude`,    // Kong ν”„λ΅μ‹ URL
  request,                             // ν‘μ¤€ Claude API ν¬λ§·
  {
    headers: {
      'Content-Type': 'application/json',
      'x-api-key': this.apiKey,
      'anthropic-version': '2023-06-01'
    }
  }
);
```

---

## π“ μ•„ν‚¤ν…μ² μ •ν™•μ„± κ²€μ¦

### β… API μΌκ΄€μ„± κ²€μ¦ κ²°κ³Ό

| κ³„μΈµ | μ…λ ¥ ν¬λ§· | μ¶λ ¥ ν¬λ§· | μΌκ΄€μ„± |
|------|-----------|-----------|---------|
| **ν΄λΌμ΄μ–ΈνΈ** | λ¦¬μ†μ¤ μμ§‘ μ”μ²­ | Backend μ‘λ‹µ | β… μ¬λ°”λ¦„ |
| **Backend** | AWS λ¦¬μ†μ¤ λ°μ΄ν„° | Claude API ν¬λ§· | β… μ¬λ°”λ¦„ |
| **Kong** | Claude API ν¬λ§· | Claude API ν¬λ§· (λ§μ¤ν‚Ή) | β… μ¬λ°”λ¦„ |
| **Claude** | λ§μ¤ν‚Ήλ API ν¬λ§· | ν‘μ¤€ Claude μ‘λ‹µ | β… μ¬λ°”λ¦„ |

### π― ν•µμ‹¬ λ°κ²¬μ‚¬ν•­

1. **ν¬λ§· λ³€ν™μ€ μ •ν™•ν•¨**: Backendκ°€ ν΄λΌμ΄μ–ΈνΈ μ”μ²­μ„ Claude API ν‘μ¤€ ν¬λ§·μΌλ΅ μ¬λ°”λ¥΄κ² λ³€ν™
2. **μ±…μ„ λ¶„λ¦¬ λ…ν™•ν•¨**: 
   - ν΄λΌμ΄μ–ΈνΈ: AWS λ¦¬μ†μ¤ μμ§‘ μ”μ²­
   - Backend: AWS λ°μ΄ν„° μμ§‘ + Claude API ν†µμ‹ 
   - Kong: λ³΄μ• λ§μ¤ν‚Ή/μ–Έλ§μ¤ν‚Ή
   - Claude: AI λ¶„μ„
3. **λ³΄μ• μ™„μ „μ„±**: Claudeλ” λ§μ¤ν‚Ήλ λ°μ΄ν„°λ§ μμ‹ 

---

## π’΅ μ‚¬μ©μ μ°λ ¤μ‚¬ν•­ κ²€ν† 

### β“ "ν΄λΌμ΄μ–ΈνΈ μ…λ ¥μ΄ Claude API ν¬λ§·κ³Ό λ‹¬λΌμ„ λ¬Έμ "

**λ¶„μ„ κ²°κ³Ό**: **μ°λ ¤ λ¶ν•„μ”**

**μ΄μ **:
1. **λ‹¤λ¥Έ λ©μ μ API**: 
   - ν΄λΌμ΄μ–ΈνΈ API: AWS λ¦¬μ†μ¤ μμ§‘ λ° λ¶„μ„ μ„λΉ„μ¤
   - Claude API: λ²”μ© AI λ€ν™” μ„λΉ„μ¤
   
2. **μ¶”μƒν™” κ³„μΈµ**: Backendκ°€ μ μ ν• μ¶”μƒν™” μ κ³µ
   ```
   ν΄λΌμ΄μ–ΈνΈ (λ¦¬μ†μ¤ μ¤‘μ‹¬) β†’ Backend (λ°μ΄ν„° λ³€ν™) β†’ Claude (ν…μ¤νΈ μ¤‘μ‹¬)
   ```

3. **μ‹¤μ  μ‚¬μ© μ‚¬λ΅€**:
   ```javascript
   // ν΄λΌμ΄μ–ΈνΈ κ΄€μ : "EC2 μΈμ¤ν„΄μ¤λ“¤μ„ λ³΄μ• λ¶„μ„ν•΄μ¤"
   {"resources": ["ec2"], "options": {"analysisType": "security_only"}}
   
   // Claude κ΄€μ : "μ΄ ν…μ¤νΈλ¥Ό λ¶„μ„ν•΄μ¤"
   {"messages": [{"role": "user", "content": "Please analyze... i-1234567890abcdef0..."}]}
   ```

### β“ "μ½”λ“ ν’μ§μ΄ λ‚λΉ μ§ μ μλ‹¤"

**λ¶„μ„ κ²°κ³Ό**: **μ½”λ“ ν’μ§ μ–‘νΈ**

**κ·Όκ±°**:
1. **λ‹¨μΌ μ±…μ„ μ›μΉ™ μ¤€μ**: κ° μ„λΉ„μ¤κ°€ λ…ν™•ν• μ—­ν•  λ‹΄λ‹Ή
2. **νƒ€μ… μ•μ „μ„±**: JSDocμΌλ΅ νƒ€μ… μ •μ μ™„λ£
3. **μ—λ¬ μ²λ¦¬**: μ μ ν• μμ™Έ μ²λ¦¬ κµ¬ν„
4. **ν…μ¤νΈ κ°€λ¥μ„±**: κ° κ³„μΈµλ³„ λ…λ¦½ ν…μ¤νΈ κ°€λ¥

### β“ "μ μ§€λ³΄μμ„±μ΄ λ–¨μ–΄μ§„λ‹¤"

**λ¶„μ„ κ²°κ³Ό**: **μ μ§€λ³΄μμ„± μ°μ**

**κ·Όκ±°**:
1. **κ΄€μ‹¬μ‚¬ λ¶„λ¦¬**: AWS λ΅μ§κ³Ό Claude λ΅μ§ λ…λ¦½
2. **ν™•μ¥μ„±**: μƒλ΅μ΄ AWS λ¦¬μ†μ¤ νƒ€μ… μ‰½κ² μ¶”κ°€ κ°€λ¥
3. **μ¬μ‚¬μ©μ„±**: Claude μ„λΉ„μ¤λ¥Ό λ‹¤λ¥Έ μ©λ„λ΅ μ¬μ‚¬μ© κ°€λ¥
4. **λ””λ²„κΉ… μ©μ΄μ„±**: κ° λ‹¨κ³„λ³„ λ΅κ·Έ λ° μ—λ¬ μ¶”μ  κ°€λ¥

---

## π—οΈ μ•„ν‚¤ν…μ² μ¥μ  λ¶„μ„

### 1. λ³΄μ• κ°•ν™”
```
μ›λ³Έ AWS λ°μ΄ν„° β†’ [λ§μ¤ν‚Ή] β†’ μ•μ „ν• λ¶„μ„ β†’ [μ–Έλ§μ¤ν‚Ή] β†’ λ³µμ›λ κ²°κ³Ό
```

### 2. μ μ—°μ„± ν™•λ³΄
- ν΄λΌμ΄μ–ΈνΈλ” AWS μ „λ¬Έ μ§€μ‹ λ¶ν•„μ”
- Backendμ—μ„ λ³µμ΅ν• AWS λ°μ΄ν„° μ²λ¦¬
- Claudeλ” μμ ν…μ¤νΈ λ¶„μ„μ— μ§‘μ¤‘

### 3. ν™•μ¥μ„±
- AWS μ™Έ λ‹¤λ¥Έ ν΄λΌμ°λ“ μ κ³µμ μ§€μ› κ°€λ¥
- λ‹¤μ–‘ν• λ¶„μ„ νƒ€μ… μ¶”κ°€ κ°€λ¥
- λ‹¤λ¥Έ AI λ¨λΈλ΅ μ‰½κ² κµμ²΄ κ°€λ¥

---

## π¨ λ€μ• μ•„ν‚¤ν…μ² κ²€ν† 

### μ‚¬μ©μ μ μ•: μ§μ ‘ Claude API ν¬λ§· μ‚¬μ©

```javascript
// μ‚¬μ©μ μ μ• ν¬λ§·
{
  "text": "Check i-1234567890abcdef0 status"
}
```

### λ¬Έμ μ  λ¶„μ„

1. **λ³΄μ• μ„ν—**: ν΄λΌμ΄μ–ΈνΈκ°€ μ§μ ‘ AWS ν¨ν„΄ λ…Έμ¶
2. **λ³µμ΅μ„± μ¦κ°€**: ν΄λΌμ΄μ–ΈνΈκ°€ AWS λ°μ΄ν„° μμ§‘ λ΅μ§ ν•„μ”
3. **μ¬μ‚¬μ©μ„± μ €ν•**: AWS μ „μ©μΌλ΅ μ ν•λ¨
4. **μ μ§€λ³΄μμ„± μ•…ν™”**: λΉ„μ¦λ‹μ¤ λ΅μ§μ΄ ν΄λΌμ΄μ–ΈνΈμ— λ¶„μ‚°

### λΉ„κµν‘

| μΈ΅λ©΄ | ν„μ¬ μ•„ν‚¤ν…μ² | μ μ• μ•„ν‚¤ν…μ² |
|------|---------------|---------------|
| **λ³΄μ•** | β… μ™„μ „ κ²©λ¦¬ | β ν΄λΌμ΄μ–ΈνΈ λ…Έμ¶ |
| **λ³µμ΅μ„±** | β… Backend μ§‘μ¤‘ | β ν΄λΌμ΄μ–ΈνΈ λ¶„μ‚° |
| **ν™•μ¥μ„±** | β… μ‰¬μ΄ ν™•μ¥ | β μ ν•μ  |
| **ν…μ¤νΈ** | β… λ…λ¦½ ν…μ¤νΈ | β ν†µν•© ν…μ¤νΈ μμ΅΄ |

---

## π― μµμΆ… κ²°λ΅ 

### β… ν„μ¬ μ•„ν‚¤ν…μ²λ” μµμ μ„

1. **API μΌκ΄€μ„±**: κ° κ³„μΈµμ—μ„ μ μ ν• ν¬λ§· μ‚¬μ©
2. **μ½”λ“ ν’μ§**: λ†’μ€ ν’μ§ μ μ§€
3. **μ μ§€λ³΄μμ„±**: μ°μν• μ μ§€λ³΄μμ„± ν™•λ³΄
4. **λ³΄μ•μ„±**: μ™„λ²½ν• λ³΄μ• κ²©λ¦¬

### π“‹ κ¶μ¥μ‚¬ν•­

1. **ν„μ¬ κµ¬μ΅° μ μ§€**: μ•„ν‚¤ν…μ² λ³€κ²½ λ¶ν•„μ”
2. **λ¬Έμ„ κ°μ„ **: κ° κ³„μΈµλ³„ μ—­ν•  λ…ν™•ν λ¬Έμ„ν™”
3. **ν…μ¤νΈ κ°•ν™”**: ν†µν•© ν…μ¤νΈλ΅ μ „μ²΄ ν”λ΅μ° κ²€μ¦
4. **λ¨λ‹ν„°λ§ μ¶”κ°€**: κ° λ³€ν™ λ‹¨κ³„λ³„ μ„±λ¥ λ¨λ‹ν„°λ§

### π€ μ¶”κ°€ κ°μ„  μ‚¬ν•­

1. **νƒ€μ… μ •μ κ°•ν™”**: TypeScript λ§μ΄κ·Έλ μ΄μ… κ³ λ ¤
2. **μΊμ‹± μµμ ν™”**: AWS λ°μ΄ν„° μΊμ‹± μ „λµ κ°μ„ 
3. **μ—λ¬ μ²λ¦¬ μ„Έλ¶„ν™”**: λ” κµ¬μ²΄μ μΈ μ—λ¬ μ½”λ“ μ •μ
4. **μ„±λ¥ μµμ ν™”**: λ€μ©λ‰ λ°μ΄ν„° μ²λ¦¬ μµμ ν™”

---

## π“ μ½”λ“ ν’μ§ μ§€ν‘

| μ§€ν‘ | ν„μ¬ μƒνƒ | λ©ν‘ | μƒνƒ |
|------|-----------|------|------|
| **νƒ€μ… μ•μ „μ„±** | JSDoc μ μ© | TypeScript | π΅ κ°μ„  κ°€λ¥ |
| **ν…μ¤νΈ μ»¤λ²„λ¦¬μ§€** | λ¶€λ¶„ μ μ© | 90%+ | π΅ κ°μ„  κ°€λ¥ |
| **λ³΄μ• μ μ** | μ™„μ „ κ²©λ¦¬ | μ™„μ „ κ²©λ¦¬ | β… μ™„λ£ |
| **μ„±λ¥** | < 5μ΄ | < 3μ΄ | π΅ κ°μ„  κ°€λ¥ |
| **κ°€λ…μ„±** | JSDoc μ™„λ£ | λ¬Έμ„ν™” μ™„λ£ | β… μ™„λ£ |

**μΆ…ν•© ν‰κ°€**: πΆ **μ°μ** (ν„μ¬ μ•„ν‚¤ν…μ² μ μ§€ κ¶μ¥)