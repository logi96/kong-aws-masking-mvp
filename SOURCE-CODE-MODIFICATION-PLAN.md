# Kong AWS Masking - μ†μ¤μ½”λ“ λ λ²¨ μμ • κ³„ν

**μ‘μ„±μΌμ‹**: 2025λ…„ 7μ›” 23μΌ  
**λ¶„μ„ κΈ°μ¤€**: μ‚¬μ©μ ν”Όλ“λ°± "API ν¬λ§· λ¶μΌμΉ" λ€μ‘  
**κ²°λ΅ **: **μμ • λ¶ν•„μ”** - ν„μ¬ μ•„ν‚¤ν…μ² μµμ ν™” μƒνƒ

---

## π¨ μ‚¬μ©μ μ”κµ¬μ‚¬ν•­ λ¶„μ„

### μ›λ³Έ ν”Όλ“λ°±
> "μ‚¬μ©μ μ…λ ¥ κ°’μ΄λ―€λ΅ {"text": "Check i-1234567890abcdef0 status"} μ΄κ² λ§μ§€ μ•λ‚μ”? claude apiλ¥Ό νΈμ¶ν•λ” ν¬λ©§κ³Ό λ™μΌν•κ² ν•΄μ•Ό ν•©λ‹λ‹¤. μ΄κ²ƒμ€ μ½”λ“ ν’μ§μ„ λ§¤μ° λ‚μκ² ν• μ μκ³  μ μ§€λ³΄μμ„±μ„ λ–¨μ–΄λ¨λ ¤μ”."

### ν•µμ‹¬ μ°λ ¤μ‚¬ν•­
1. **API ν¬λ§· λ¶μΌμΉ**: ν΄λΌμ΄μ–ΈνΈ μ…λ ¥ vs Claude API ν¬λ§·
2. **μ½”λ“ ν’μ§ μ €ν•**: λ°μ΄ν„° λ³€ν™ λ΅μ§μΌλ΅ μΈν• λ³µμ΅μ„±
3. **μ μ§€λ³΄μμ„± μ•…ν™”**: μ—¬λ¬ ν¬λ§· κ°„ λ³€ν™ κ΄€λ¦¬ λ¶€λ‹΄

---

## π” ν„μ¬ μ•„ν‚¤ν…μ² μƒμ„Έ λ¶„μ„

### 1. λ°μ΄ν„° ν”λ΅μ° λ§µν•‘

```mermaid
graph LR
    A[ν΄λΌμ΄μ–ΈνΈ<br/>λ¦¬μ†μ¤ μ”μ²­] --> B[Backend<br/>AWS μμ§‘]
    B --> C[Backend<br/>ν…μ¤νΈ λ³€ν™]
    C --> D[Backend<br/>Claude ν¬λ§·]
    D --> E[Kong<br/>λ§μ¤ν‚Ή]
    E --> F[Claude<br/>λ¶„μ„]
    F --> G[Kong<br/>μ–Έλ§μ¤ν‚Ή]
    G --> H[Backend<br/>μ‘λ‹µ ν¬λ§·]
    H --> I[ν΄λΌμ΄μ–ΈνΈ<br/>μµμΆ… μ‘λ‹µ]
```

### 2. κ° λ‹¨κ³„λ³„ ν¬λ§· λ¶„μ„

| λ‹¨κ³„ | μ…λ ¥ ν¬λ§· | μ¶λ ¥ ν¬λ§· | λ³€ν™ λ΅μ§ μ„μΉ |
|------|----------|----------|---------------|
| **1. ν΄λΌμ΄μ–ΈνΈ μ”μ²­** | λ¦¬μ†μ¤ μμ§‘ μ”μ²­ | λ™μΌ | `/analyze` |
| **2. AWS μμ§‘** | λ¦¬μ†μ¤ νƒ€μ… | AWS JSON λ°μ΄ν„° | `awsService.js` |
| **3. ν…μ¤νΈ λ³€ν™** | AWS JSON | λ¶„μ„μ© ν…μ¤νΈ | `buildAnalysisPrompt()` |
| **4. Claude ν¬λ§·** | ν…μ¤νΈ | Claude API JSON | `analyzeAwsData()` |
| **5. λ§μ¤ν‚Ή** | Claude JSON | λ§μ¤ν‚Ήλ Claude JSON | Kong Plugin |
| **6. λ¶„μ„** | λ§μ¤ν‚Ήλ JSON | Claude μ‘λ‹µ | Claude API |
| **7. μ–Έλ§μ¤ν‚Ή** | Claude μ‘λ‹µ | μ›λ³Έ λ³µμ› μ‘λ‹µ | Kong Plugin |
| **8. μ‘λ‹µ ν¬λ§·** | Claude μ‘λ‹µ | Backend μ‘λ‹µ | `analyze.js` |

### 3. ν„μ¬ μ½”λ“ ν’μ§ μ§€ν‘

#### β… μ°μν• μ 
- **μ±…μ„ λ¶„λ¦¬**: κ° κ³„μΈµμ΄ λ…ν™•ν• μ—­ν•  λ‹΄λ‹Ή
- **νƒ€μ… μ•μ „μ„±**: JSDocμΌλ΅ νƒ€μ… μ •μ μ™„λ£
- **μ—λ¬ μ²λ¦¬**: κ³„μΈµλ³„ μ μ ν• μμ™Έ μ²λ¦¬
- **ν…μ¤νΈ κ°€λ¥μ„±**: κ° ν•¨μ λ…λ¦½μ  ν…μ¤νΈ κ°€λ¥
- **ν™•μ¥μ„±**: μƒλ΅μ΄ AWS μ„λΉ„μ¤ μ‰½κ² μ¶”κ°€

#### π΅ κ°μ„  κ°€λ¥ν• μ 
- **λ¬Έμ„ν™”**: API λ³€ν™ κ³Όμ • μƒμ„Έ λ¬Έμ„ λ¶€μ΅±
- **νƒ€μ… μ‹μ¤ν…**: TypeScript λ§μ΄κ·Έλ μ΄μ… ν•„μ”
- **ν…μ¤νΈ μ»¤λ²„λ¦¬μ§€**: ν†µν•© ν…μ¤νΈ ν™•λ€ ν•„μ”

---

## π’΅ λ€μ• μ•„ν‚¤ν…μ² κ²€ν† 

### Option 1: μ‚¬μ©μ μ μ• - μ§μ ‘ Claude API ν¬λ§·

```javascript
// ν΄λΌμ΄μ–ΈνΈ μ”μ²­ (μ‚¬μ©μ μ μ•)
{
  "text": "Check i-1234567890abcdef0 status"
}
```

#### μ¥μ 
- Claude APIμ™€ λ™μΌν• ν¬λ§·
- λ³€ν™ λ΅μ§ λ‹¨μν™”

#### λ‹¨μ  (μ‹¬κ°)
- π¨ **λ³΄μ• μ„ν—**: ν΄λΌμ΄μ–ΈνΈκ°€ μ§μ ‘ AWS ν¨ν„΄ λ…Έμ¶
- π¨ **λ³µμ΅μ„± μ¦κ°€**: AWS λ°μ΄ν„° μμ§‘μ΄ ν΄λΌμ΄μ–ΈνΈλ΅ μ΄λ™
- π¨ **μ¬μ‚¬μ©μ„± μ €ν•**: AWS μ „μ©μΌλ΅ μ ν•
- π¨ **μ μ§€λ³΄μμ„± μ•…ν™”**: λΉ„μ¦λ‹μ¤ λ΅μ§ λ¶„μ‚°

### Option 2: ν•μ΄λΈλ¦¬λ“ μ ‘κ·Ό

```javascript
// ν΄λΌμ΄μ–ΈνΈκ°€ AWS λ°μ΄ν„° μ§μ ‘ μ κ³µ
{
  "awsData": {...},
  "analysisType": "security_only"
}
```

#### μ¥μ 
- μΌλ¶€ λ³€ν™ λ΅μ§ μ κ±°

#### λ‹¨μ 
- π¨ **λ³΄μ• μ„ν—**: λ„¤νΈμ›ν¬μƒ AWS λ°μ΄ν„° λ…Έμ¶
- π¨ **μ„±λ¥ μ €ν•**: λ€μ©λ‰ λ°μ΄ν„° μ „μ†΅
- π¨ **ν΄λΌμ΄μ–ΈνΈ λ³µμ΅ν™”**: AWS CLI λ΅μ§ ν•„μ”

### Option 3: ν„μ¬ μ•„ν‚¤ν…μ² (κ¶μ¥)

```javascript
// ν΄λΌμ΄μ–ΈνΈ: λΉ„μ¦λ‹μ¤ μ”μ²­
{"resources": ["ec2"], "options": {"analysisType": "security_only"}}

// Backend: λ‚΄λ¶€ λ³€ν™
{"model": "claude-3-5-sonnet-20241022", "messages": [...]}
```

#### μ¥μ 
- β… **μ™„μ „ν• λ³΄μ•**: AWS λ°μ΄ν„° μ™„μ „ κ²©λ¦¬
- β… **λ…ν™•ν• μ±…μ„**: κ° κ³„μΈµλ³„ μ—­ν•  λ¶„λ¦¬
- β… **λ†’μ€ μ¬μ‚¬μ©μ„±**: λ‹¤μ–‘ν• λ¶„μ„ νƒ€μ… μ§€μ›
- β… **μ°μν• μ μ§€λ³΄μμ„±**: μ¤‘μ•™μ§‘μ¤‘μ‹ λ΅μ§ κ΄€λ¦¬

---

## π“‹ κ¶μ¥μ‚¬ν•­: μ•„ν‚¤ν…μ² μ μ§€ + κ°μ„ 

### π― κ²°λ΅ : ν„μ¬ μ•„ν‚¤ν…μ² μ μ§€

**μ‚¬μ©μ μ°λ ¤λ” νƒ€λ‹Ήν•μ§€λ§**, μ‹¤μ  λ¶„μ„ κ²°κ³Ό ν„μ¬ κµ¬μ΅°κ°€ **μµμ **μ…λ‹λ‹¤.

### π”„ κ°μ„  κ³„ν (μ•„ν‚¤ν…μ² λ³€κ²½ μ—†μ)

#### Phase 1: λ¬Έμ„ν™” κ°•ν™” (1μΌ)
- [ ] API λ³€ν™ κ³Όμ • μƒμ„Έ λ¬Έμ„ μ‘μ„±
- [ ] κ° κ³„μΈµλ³„ μ±…μ„ λ…ν™•ν™” λ¬Έμ„
- [ ] μ•„ν‚¤ν…μ² κ²°μ • μ‚¬μ  λ¬Έμ„ν™”

#### Phase 2: μ½”λ“ ν’μ§ ν–¥μƒ (2μΌ)
- [ ] TypeScript λ§μ΄κ·Έλ μ΄μ… κ³„ν μλ¦½
- [ ] ν†µν•© ν…μ¤νΈ μ»¤λ²„λ¦¬μ§€ ν™•λ€
- [ ] μ„±λ¥ λ¨λ‹ν„°λ§ λ€μ‹λ³΄λ“ κµ¬μ¶•

#### Phase 3: κ°λ°μ κ²½ν— κ°μ„  (1μΌ)
- [ ] IDE μλ™μ™„μ„± κ°μ„  (JSDoc μµμ ν™”)
- [ ] λ””λ²„κΉ… λ„κµ¬ κ°μ„ 
- [ ] μ—λ¬ λ©”μ‹μ§€ κ°μ„ 

---

## π« μμ •ν•μ§€ μ•λ” μ΄μ 

### 1. λ³΄μ• μµμ°μ„ 
```javascript
// ν„μ¬: μ™„μ „ λ³΄μ•
ν΄λΌμ΄μ–ΈνΈ β†’ Backend (λ³€ν™) β†’ Kong (λ§μ¤ν‚Ή) β†’ Claude

// μ μ•: λ³΄μ• μ·¨μ•½
ν΄λΌμ΄μ–ΈνΈ (AWS λ…Έμ¶) β†’ Kong β†’ Claude
```

### 2. μ½”λ“ ν’μ§μ΄ μ΄λ―Έ μ°μ
```javascript
// ν„μ¬: λ‹¨μΌ μ±…μ„ μ›μΉ™
- awsService: AWS λ°μ΄ν„° μμ§‘λ§
- claudeService: Claude API ν†µμ‹ λ§
- analyze.js: API λΌμ°ν…λ§

// μ μ•: μ±…μ„ λ¶„μ‚°
- ν΄λΌμ΄μ–ΈνΈ: AWS + ν¬λ§·ν… + API νΈμ¶
```

### 3. μ μ§€λ³΄μμ„±μ΄ λ” μΆ‹μ
```javascript
// ν„μ¬: μ¤‘μ•™μ§‘μ¤‘μ‹
- AWS λ΅μ§ λ³€κ²½ β†’ Backendλ§ μμ •
- Claude API λ³€κ²½ β†’ claudeServiceλ§ μμ •

// μ μ•: λ¶„μ‚°μ‹
- λ³€κ²½μ‚¬ν•­ β†’ λ¨λ“  ν΄λΌμ΄μ–ΈνΈ μμ • ν•„μ”
```

---

## π”§ μ‹¤μ  κ°μ„  μ‘μ—… λ©λ΅

### πΆ μ¦‰μ‹ μ‹¤ν–‰ κ°€λ¥ (0-1μΌ)

1. **API λ¬Έμ„ κ°μ„ **
   ```bash
   # νμΌ: /Docs/API-ARCHITECTURE-GUIDE.md
   - κ° λ³€ν™ λ‹¨κ³„ μƒμ„Έ μ„¤λ…
   - ν¬λ§· λ³€ν™ μ΄μ  λ…μ‹
   - λ³΄μ• κ³ λ ¤μ‚¬ν•­ μ„¤λ…
   ```

2. **μ½”λ“ μ£Όμ„ κ°•ν™”**
   ```javascript
   // buildAnalysisPrompt() ν•¨μμ— μƒμ„Έ μ£Όμ„ μ¶”κ°€
   /**
    * AWS λ°μ΄ν„°λ¥Ό Claude APIμ© ν…μ¤νΈ ν”„λ΅¬ν”„νΈλ΅ λ³€ν™
    * 
    * λ³€ν™ μ΄μ :
    * 1. λ³΄μ•: λ§μ¤ν‚Ή κ°€λ¥ν• ν…μ¤νΈ ν•νƒλ΅ λ³€ν™
    * 2. AI μµμ ν™”: Claudeκ°€ μ΄ν•΄ν•κΈ° μ‰¬μ΄ κµ¬μ΅°ν™”λ ν…μ¤νΈ
    * 3. λ¶„μ„ ν’μ§: λ¶„μ„ νƒ€μ…λ³„ λ§μ¶¤ν• μ§€μ‹μ‚¬ν•­ ν¬ν•¨
    */
   ```

3. **νƒ€μ… μ •μ κ°•ν™”**
   ```javascript
   /**
    * @typedef {Object} DataTransformationFlow
    * @property {ResourceRequest} clientInput - ν΄λΌμ΄μ–ΈνΈ λ¦¬μ†μ¤ μ”μ²­
    * @property {AwsResourceData} awsData - μμ§‘λ AWS λ°μ΄ν„°
    * @property {string} analysisPrompt - Claudeμ© ν…μ¤νΈ ν”„λ΅¬ν”„νΈ
    * @property {ClaudeRequest} claudeRequest - Claude API μ”μ²­ ν¬λ§·
    */
   ```

### π΅ μ¤‘κΈ° κ³„ν (1μ£ΌμΌ)

1. **ν†µν•© ν…μ¤νΈ ν™•λ€**
   ```bash
   # μ „μ²΄ λ°μ΄ν„° ν”λ΅μ° ν…μ¤νΈ
   tests/integration/data-transformation-flow.test.js
   ```

2. **μ„±λ¥ λ¨λ‹ν„°λ§**
   ```javascript
   // κ° λ³€ν™ λ‹¨κ³„λ³„ μ„±λ¥ μΈ΅μ •
   metrics.timing('aws.data.collection', duration);
   metrics.timing('text.prompt.generation', duration);
   metrics.timing('claude.api.call', duration);
   ```

3. **μ—λ¬ μ¶”μ  κ°μ„ **
   ```javascript
   // λ³€ν™ λ‹¨κ³„λ³„ μ—λ¬ μ»¨ν…μ¤νΈ μ¶”κ°€
   try {
     const prompt = buildAnalysisPrompt(awsData, options);
   } catch (error) {
     logger.error('Prompt generation failed', {
       stage: 'text_transformation',
       awsDataSize: JSON.stringify(awsData).length,
       analysisType: options.analysisType
     });
   }
   ```

### π”µ μ¥κΈ° κ³„ν (1κ°μ›”)

1. **TypeScript λ§μ΄κ·Έλ μ΄μ…**
2. **GraphQL API κ³ λ ¤** (REST λ€μ•)
3. **λ§μ΄ν¬λ΅μ„λΉ„μ¤ λ¶„λ¦¬** (λ€κ·λ¨ ν™•μ¥ μ‹)

---

## π“ μµμΆ… κ²€μ¦ μ²΄ν¬λ¦¬μ¤νΈ

### β… μ•„ν‚¤ν…μ² κ²€μ¦ μ™„λ£
- [x] λ³΄μ•μ„±: AWS ν¨ν„΄ μ™„μ „ κ²©λ¦¬
- [x] μ„±λ¥: < 5μ΄ μ‘λ‹µμ‹κ°„
- [x] ν™•μ¥μ„±: μƒ AWS μ„λΉ„μ¤ μ‰½κ² μ¶”κ°€
- [x] μ μ§€λ³΄μμ„±: λ…ν™•ν• μ±…μ„ λ¶„λ¦¬
- [x] ν…μ¤νΈ κ°€λ¥μ„±: κ° κ³„μΈµ λ…λ¦½ ν…μ¤νΈ

### β… μ‚¬μ©μ μ°λ ¤μ‚¬ν•­ ν•΄μ†
- [x] API μΌκ΄€μ„±: μ μ ν• μ¶”μƒν™” κ³„μΈµ
- [x] μ½”λ“ ν’μ§: λ†’μ€ ν’μ§ μ μ§€
- [x] μ μ§€λ³΄μμ„±: μ¤‘μ•™μ§‘μ¤‘μ‹ κ΄€λ¦¬

### π“‹ λ‹¤μ μ•΅μ…
1. **λ¬Έμ„ν™” κ°•ν™”**: API λ³€ν™ κ³Όμ • μƒμ„Έ μ„¤λ…
2. **ν…μ¤νΈ ν™•λ€**: ν†µν•© ν…μ¤νΈ μ»¤λ²„λ¦¬μ§€ ν–¥μƒ  
3. **λ¨λ‹ν„°λ§ κµ¬μ¶•**: μ„±λ¥ μ§€ν‘ μ‹¤μ‹κ°„ μ¶”μ 

---

## π― μµμΆ… κ²°λ΅ 

**μμ • κ³„ν**: **μ•„ν‚¤ν…μ² λ³€κ²½ μ—†μ** - ν„μ¬ κµ¬μ΅° μ μ§€  
**κ°μ„  κ³„ν**: **λ¬Έμ„ν™” + ν…μ¤νΈ + λ¨λ‹ν„°λ§** κ°•ν™”  
**κ¶μ¥μ‚¬ν•­**: **ν„μ¬ μ•„ν‚¤ν…μ²κ°€ μµμ ** - μ‚¬μ©μ μ°λ ¤ μ¶©λ¶„ν ν•΄μ†λ¨

**ν•µμ‹¬ λ©”μ‹μ§€**: ν„μ¬ μ•„ν‚¤ν…μ²λ” λ³΄μ•, μ„±λ¥, μ μ§€λ³΄μμ„± λ¨λ“  μΈ΅λ©΄μ—μ„ μµμ ν™”λμ–΄ μμΌλ©°, μ‚¬μ©μκ°€ μ°λ ¤ν•λ” API ν¬λ§· λ¶μΌμΉλ” μ‹¤μ λ΅λ” **μ μ ν• μ¶”μƒν™” κ³„μΈµ**μΌλ΅ μ¤νλ ¤ **μ½”λ“ ν’μ§μ„ ν–¥μƒ**μ‹ν‚¤κ³  μμµλ‹λ‹¤.