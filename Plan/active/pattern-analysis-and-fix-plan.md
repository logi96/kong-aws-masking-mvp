# Kong AWS Masker íŒ¨í„´ ë¶„ì„ ë° ìˆ˜ì • ê³„íš

## ğŸ” ìƒì„¸ ë¶„ì„ ê²°ê³¼

### 1. íŒ¨í„´ ì‹œìŠ¤í…œ êµ¬ì¡°
í˜„ì¬ ì‹œìŠ¤í…œì€ 3ë‹¨ê³„ êµ¬ì¡°ë¡œ ë˜ì–´ ìˆìŠµë‹ˆë‹¤:

1. **patterns.lua** - ê¸°ë³¸ íŒ¨í„´ ì •ì˜ (50ê°œ)
   - ë‹¨ìˆœí•œ 10ìë¦¬ API Gateway íŒ¨í„´ í¬í•¨ (ë¬¸ì œì˜ ì›ì¸)
   ```lua
   api_gateway = {
     pattern = "[a-z0-9][a-z0-9][a-z0-9][a-z0-9][a-z0-9][a-z0-9][a-z0-9][a-z0-9][a-z0-9][a-z0-9]",
     replacement = "API_GW_%03d"
   }
   ```

2. **patterns_extension.lua** - í™•ì¥ íŒ¨í„´ ì •ì˜ (40ê°œ ì¶”ê°€)
   - ë” êµ¬ì²´ì ì¸ API Gateway íŒ¨í„´ í¬í•¨
   ```lua
   api_gateway_id = {
     pattern = "([a-z0-9]{10})%.execute%-api%.([^%.]+)%.amazonaws%.com",
     replacement = "APIGW_%03d.execute-api.$2.amazonaws.com"
   }
   ```

3. **pattern_integrator.lua** - íŒ¨í„´ í†µí•© ë° ìš°ì„ ìˆœìœ„ ê´€ë¦¬
   - ì¶©ëŒ ê²€ì‚¬
   - ìš°ì„ ìˆœìœ„ ì¬ì¡°ì •

### 2. í˜„ì¬ ë¬¸ì œì 

#### 2.1 íŒ¨í„´ í†µí•© ë¯¸ì‚¬ìš©
- `masker_ngx_re.lua`ê°€ `patterns.lua`ë§Œ ì‚¬ìš©
- `pattern_integrator.lua`ê°€ ì‹¤ì œë¡œ í˜¸ì¶œë˜ì§€ ì•ŠìŒ
- í™•ì¥ íŒ¨í„´ë“¤ì´ ì ìš©ë˜ì§€ ì•ŠìŒ

#### 2.2 API Gateway íŒ¨í„´ ê³¼ë„í•œ ë§¤ì¹­
- 10ìë¦¬ ì†Œë¬¸ì/ìˆ«ì ì¡°í•©ì„ ëª¨ë‘ ë§¤ì¹­
- ì¼ë°˜ í…ìŠ¤íŠ¸ê¹Œì§€ ë§ˆìŠ¤í‚¹ë˜ì–´ ì»¨í…ìŠ¤íŠ¸ ì†ì‹¤

#### 2.3 íŒ¨í„´ ì´ˆê¸°í™” ë¡œì§
```lua
-- masker_ngx_re.lua:194
function _M.init_patterns()
  for name, pattern_def in pairs(patterns.patterns) do
    -- patterns.luaë§Œ ì‚¬ìš© ì¤‘
  end
end
```

### 3. spec í´ë” ë¶„ì„ ê²°ê³¼

í…ŒìŠ¤íŠ¸ íŒŒì¼ êµ¬ì¡°:
- `unit/` - ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
  - `handler_spec.lua` - í•¸ë“¤ëŸ¬ í…ŒìŠ¤íŠ¸
  - `masker_spec.lua` - ë§ˆìŠ¤í‚¹ ë¡œì§ í…ŒìŠ¤íŠ¸
  - `patterns_spec.lua` - íŒ¨í„´ í…ŒìŠ¤íŠ¸
  - `schema_spec.lua` - ìŠ¤í‚¤ë§ˆ ê²€ì¦
- `integration/` - í†µí•© í…ŒìŠ¤íŠ¸
- `mock_data.lua` - í…ŒìŠ¤íŠ¸ìš© ëª¨ì˜ ë°ì´í„°
- `mock_kong.lua` - Kong API ëª¨ì˜ ê°ì²´

## ğŸ¯ êµ¬ì²´ì  ìˆ˜ì • ê³„íš

### Phase 1: ì¦‰ì‹œ ìˆ˜ì • (ê¸´ê¸‰)

#### 1.1 API Gateway íŒ¨í„´ ìˆ˜ì •
```lua
-- patterns.lua ìˆ˜ì •
api_gateway = {
  -- ê¸°ì¡´: "[a-z0-9][a-z0-9][a-z0-9][a-z0-9][a-z0-9][a-z0-9][a-z0-9][a-z0-9][a-z0-9][a-z0-9]"
  -- ìˆ˜ì •: API Gateway IDëŠ” execute-api URLì—ì„œë§Œ ì°¾ë„ë¡ ë³€ê²½
  pattern = "([a-z0-9]{10})(?=%.execute%-api%.)",
  replacement = "API_GW_%03d",
  type = "apigateway",
  description = "API Gateway ID (in execute-api URLs only)"
}
```

#### 1.2 íŒ¨í„´ í†µí•© í™œì„±í™”
```lua
-- masker_ngx_re.lua ìˆ˜ì •
local patterns = require "kong.plugins.aws-masker.patterns"
local pattern_integrator = require "kong.plugins.aws-masker.pattern_integrator"  -- ì¶”ê°€

function _M.init_patterns()
  -- ê¸°ì¡´ íŒ¨í„´ê³¼ í™•ì¥ íŒ¨í„´ í†µí•©
  local integrated_patterns = pattern_integrator.integrate_patterns(patterns.patterns)
  
  for _, pattern_def in ipairs(integrated_patterns) do
    -- íŒ¨í„´ ì´ˆê¸°í™” ë¡œì§
  end
end
```

### Phase 2: ê²€ì¦ ë° í…ŒìŠ¤íŠ¸

#### 2.1 ë‹¨ì¼ íŒ¨í„´ í…ŒìŠ¤íŠ¸
- EC2 ì¸ìŠ¤í„´ìŠ¤ ID ë§ˆìŠ¤í‚¹ í™•ì¸
- API Gateway íŒ¨í„´ì´ ê³¼ë„í•˜ê²Œ ë§¤ì¹­ë˜ì§€ ì•ŠëŠ”ì§€ í™•ì¸
- ê° AWS ë¦¬ì†ŒìŠ¤ íƒ€ì…ë³„ ê²€ì¦

#### 2.2 50ê°œ íŒ¨í„´ ì¬ì‹¤í–‰
- ìˆ˜ì •ëœ íŒ¨í„´ìœ¼ë¡œ ì „ì²´ í…ŒìŠ¤íŠ¸
- ë³´ì•ˆ ê²€ì¦ (Claudeê°€ ì›ë³¸ì„ ë³¼ ìˆ˜ ì—†ëŠ”ì§€)
- ì„±ëŠ¥ ì¸¡ì •

### Phase 3: ìµœì í™” ë° ì •ë¦¬

#### 3.1 ë¶ˆí•„ìš”í•œ ì½”ë“œ ì œê±°
- ì¤‘ë³µ íŒ¨í„´ ì œê±°
- ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” í…ŒìŠ¤íŠ¸ íŒŒì¼ ì •ë¦¬
- ì£¼ì„ ì²˜ë¦¬ëœ ì½”ë“œ ì œê±°

#### 3.2 ë¬¸ì„œí™”
- íŒ¨í„´ í†µí•© í”„ë¡œì„¸ìŠ¤ ë¬¸ì„œí™”
- API Gateway íŒ¨í„´ ìˆ˜ì • ì‚¬ìœ  ê¸°ë¡
- í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë³´ê³ ì„œ ì‘ì„±

## ğŸš¨ ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

1. **íŒ¨í„´ ìš°ì„ ìˆœìœ„**
   - ë” êµ¬ì²´ì ì¸ íŒ¨í„´ì´ ë¨¼ì € ë§¤ì¹­ë˜ë„ë¡ ìš°ì„ ìˆœìœ„ ì¡°ì •
   - ê³¼ë„í•œ ë§¤ì¹­ ë°©ì§€

2. **Fail-Secure**
   - íŒ¨í„´ ë§¤ì¹­ ì‹¤íŒ¨ ì‹œ ìš”ì²­ ì°¨ë‹¨
   - ì—ëŸ¬ ë°œìƒ ì‹œ ì›ë³¸ ë…¸ì¶œ ë°©ì§€

3. **ì„±ëŠ¥ ì˜í–¥**
   - íŒ¨í„´ ìˆ˜ ì¦ê°€ë¡œ ì¸í•œ ì„±ëŠ¥ ì˜í–¥ ìµœì†Œí™”
   - Redis ìºì‹± í™œìš©

## ğŸ“‹ ì‹¤í–‰ ìˆœì„œ

1. **ë°±ì—…** - í˜„ì¬ patterns.lua ë°±ì—…
2. **ìˆ˜ì •** - API Gateway íŒ¨í„´ ìˆ˜ì •
3. **í†µí•©** - pattern_integrator í™œì„±í™”
4. **ì¬ì‹œì‘** - Kong ì¬ì‹œì‘
5. **í…ŒìŠ¤íŠ¸** - ë‹¨ì¼ íŒ¨í„´ í…ŒìŠ¤íŠ¸
6. **ê²€ì¦** - 50ê°œ íŒ¨í„´ ì „ì²´ í…ŒìŠ¤íŠ¸
7. **ë³´ê³ ** - ê²°ê³¼ ë³´ê³ ì„œ ì‘ì„±

## â±ï¸ ì˜ˆìƒ ì†Œìš” ì‹œê°„

- Phase 1: 30ë¶„ (ì½”ë“œ ìˆ˜ì • ë° ì¬ì‹œì‘)
- Phase 2: 1ì‹œê°„ (í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë° ê²€ì¦)
- Phase 3: 30ë¶„ (ìµœì í™” ë° ë¬¸ì„œí™”)

ì´ ì˜ˆìƒ ì‹œê°„: 2ì‹œê°„

## ğŸ¯ ì„±ê³µ ê¸°ì¤€

1. API Gateway íŒ¨í„´ì´ ì˜ë„í•œ ëŒ€ë¡œë§Œ ë§¤ì¹­
2. 50ê°œ íŒ¨í„´ ëª¨ë‘ ì •ìƒ ì‘ë™
3. Claudeê°€ ë§ˆìŠ¤í‚¹ëœ ë°ì´í„°ë§Œ ìˆ˜ì‹ 
4. ì„±ëŠ¥ ì €í•˜ ì—†ìŒ (< 5ì´ˆ ì‘ë‹µ)